{"version":3,"sources":["panels/events.js","context/chatListContext.js","panels/messages.js","hooks/useShortText.js","panels/profile.js","context/chatContext.js","components/textSeparator.js","messageComponents/message.js","messageComponents/messageList.js","panels/chat.js","App.js","index.js"],"names":["Events","style","height","icon","width","axios","require","Context","createContext","ChatListContextProvider","children","useState","chats","setChats","currentPage","setCurrentPage","totalCount","setTotalCount","limit","fetching","setFetching","endOfPage","setEndOfPage","useEffect","get","then","response","data","filter","e","findIndex","c","id","prev","headers","finally","window","addEventListener","scrollHandler","removeEventListener","length","target","documentElement","scrollHeight","scrollTop","innerHeight","Provider","value","Messages","onChatOpen","useContext","className","separator","map","before","gradientColor","calcInitialsAvatarColor","title","substring","onClick","subtitle","str","indicator","mode","Profile","useChatContextProvider","ChatContextProvider","chat","messages","setMessages","members","setMembers","needScroll","setNeedScroll","newMessageCount","setNewMessageCount","a","setTimeout","getMessages","scrollTo","scrollX","document","body","sendMessage","text","TextSeparator","Message","self","caption","hasAvatar","avatar","size","MessageList","isPublic","setScrollHeight","bottomRef","useRef","useLayoutEffect","current","scrollIntoView","behavior","marginTop","m","index","arr","Fragment","email","ref","Chat","onClose","writeBarText","setWriteBarText","bottomPadding","setBottomPadding","fixedLayoutInnerElRef","status","vertical","paddingBottom","wide","onChange","onHeightChange","el","offsetHeight","updateBottomPadding","placeholder","after","disabled","App","scheme","React","activeStory","setActiveStory","messagesActivePanel","setMessagesActivePanel","setChat","hasTabbar","setHasTabbar","onStoryChange","currentTarget","dataset","story","header","justifyContent","animate","spaced","maxWidth","tabbar","selected","activePanel","bridge","send","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.cbf9aa24.chunk.js","sourcesContent":["import { Icon56NewsfeedOutline } from \"@vkontakte/icons\"\r\nimport { Group, PanelHeader, PanelHeaderBack, Placeholder } from \"@vkontakte/vkui\"\r\n\r\nexport const Events = () => {\r\n    return (\r\n        <>\r\n            <PanelHeader>События</PanelHeader>\r\n            <Group style={{ height: \"1000px\" }}>\r\n                <Placeholder\r\n                    icon={<Icon56NewsfeedOutline width={56} height={56} />}\r\n                />\r\n            </Group>\r\n        </>\r\n    )\r\n}\r\n","import { createContext, useContext, useEffect, useState } from \"react\";\r\nconst axios = require('axios');\r\n\r\nconst Context = createContext()\r\n\r\nexport const useChatListContextProvider = () => {\r\n    return useContext(Context)\r\n}\r\n\r\nexport const ChatListContextProvider = ({children}) => {\r\n\r\n    const [chats, setChats] = useState([])\r\n    const [currentPage, setCurrentPage] = useState(1)\r\n    const [totalCount, setTotalCount] = useState(0)\r\n    const [limit] = useState(15)\r\n    const [fetching, setFetching] = useState(true)\r\n    const [endOfPage, setEndOfPage] = useState(false)\r\n\r\n    useEffect(() => {\r\n        if (fetching) {\r\n            axios\r\n                .get(`https://jsonplaceholder.typicode.com/posts?_limit=${limit}&_page=${currentPage}`)\r\n                .then(response => {\r\n                    setChats([...chats, ...response.data.filter(e => chats.findIndex(c => c.id == e.id) < 0)])\r\n                    setCurrentPage(prev => prev + 1)\r\n                    setTotalCount(response.headers[\"x-total-count\"])\r\n                })\r\n                .finally(() => {\r\n                    setEndOfPage(false)\r\n                    setFetching(false)\r\n                })\r\n        }\r\n    }, [fetching])\r\n\r\n    useEffect(() => {\r\n        window.addEventListener(\"scroll\", scrollHandler)\r\n        return function () {\r\n            window.removeEventListener(\"scroll\", scrollHandler)\r\n        }\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n        if (endOfPage && chats.length < totalCount) {\r\n            setFetching(true)\r\n        }\r\n    }, [endOfPage])\r\n\r\n    const scrollHandler = (e) => {\r\n        if (e.target.documentElement.scrollHeight - (e.target.documentElement.scrollTop + window.innerHeight) < 100) {\r\n            setEndOfPage(true)\r\n        }\r\n    }\r\n\r\n    const newMessageHandler = (message) => {\r\n        const index = chats.findIndex(e => e.id == message.id)\r\n        if (index > -1) {\r\n            const temp = [...chats]\r\n            temp.splice(index, 1)\r\n            setChats([message, ...temp])\r\n        } else {\r\n            setChats([message, ...chats])\r\n        };\r\n    }\r\n\r\n    return (\r\n        <Context.Provider value={{\r\n            chats,\r\n            fetching\r\n        }}>\r\n            {children}\r\n        </Context.Provider>\r\n    )\r\n}","import { calcInitialsAvatarColor, Counter, Group, InitialsAvatar, List, PanelHeader, RichCell, SimpleCell, Spinner, Text, Title } from \"@vkontakte/vkui\"\r\nimport { useEffect } from \"react\"\r\nimport { useChatListContextProvider } from \"../context/chatListContext\"\r\nimport { useShortText } from \"../hooks/useShortText\"\r\n\r\nexport const Messages = ({onChatOpen}) => {\r\n\r\n    const { chats, fetching } = useChatListContextProvider()\r\n\r\n    return (\r\n        <>\r\n            <PanelHeader className=\"shadowPanelHeader\" separator={false}>Сообщения</PanelHeader>\r\n            <Group>\r\n                <List>\r\n                    {\r\n                        chats.map(e => {\r\n                            return (\r\n                                <SimpleCell\r\n                                    before={\r\n                                        <InitialsAvatar gradientColor={calcInitialsAvatarColor(e.id)}>\r\n                                            {e.title.substring(0, 2)}\r\n                                        </InitialsAvatar>}\r\n                                    key={e.id}\r\n                                    onClick={() => onChatOpen(e)}\r\n                                    subtitle={\r\n                                        <>{useShortText(\"Алексей: стикер cnbrth cnbrth cnbrth cnbrt\", 25)} &#183; 2h</>\r\n                                    }\r\n                                    indicator={<Counter mode=\"primary\">10</Counter>}\r\n                                >\r\n                                    {e.title.substring(0, 10)}\r\n                                </SimpleCell>\r\n                            )\r\n                        })\r\n                    }\r\n                    {fetching && <Spinner />}\r\n                </List>\r\n            </Group>\r\n        </>\r\n    )\r\n}","export const useShortText = (str, length) => {\r\n    return str.length > length ? str.substring(0, length) + \"...\" : str\r\n}","import { Icon28UserCircleOutline } from \"@vkontakte/icons\"\r\nimport { Group, PanelHeader, PanelHeaderBack, Placeholder } from \"@vkontakte/vkui\"\r\n\r\nexport const Profile = () => {\r\n    return (\r\n        <>\r\n            <PanelHeader>Профиль</PanelHeader>\r\n            <Group style={{ height: \"1000px\" }}>\r\n                <Placeholder\r\n                    icon={<Icon28UserCircleOutline width={56} height={56} />}\r\n                ></Placeholder>\r\n            </Group>\r\n        </>\r\n    )\r\n}","import axios from \"axios\";\r\nimport { createContext, useContext, useEffect, useLayoutEffect, useRef, useState } from \"react\";\r\n\r\nconst Context = createContext()\r\n\r\nexport const useChatContextProvider = () => {\r\n    return useContext(Context)\r\n}\r\n\r\nexport const ChatContextProvider = ({children, chat}) => {\r\n    const [messages, setMessages] = useState([])\r\n    const [members, setMembers] = useState([]);\r\n    const [fetching, setFetching] = useState(true);\r\n    const [currentPage, setCurrentPage] = useState(1)\r\n    const [totalCount, setTotalCount] = useState(0)\r\n    const [limit] = useState(30)\r\n    const [endOfPage, setEndOfPage] = useState(false)\r\n    const [needScroll, setNeedScroll] = useState(true)\r\n    const [newMessageCount, setNewMessageCount] = useState(2)\r\n\r\n    useEffect(async () => {\r\n        // const membersResponse = await axios.get(\"https://b451dbd8trial-dev-dice.cfapps.us10.hana.ondemand.com/main/Users\")\r\n        // setMembers([...membersResponse.data.value])\r\n        setMembers([1])\r\n        setTimeout(() => {\r\n            getMessages()\r\n        }, 500)\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (fetching && members.length > 0) {\r\n            getMessages()\r\n        }\r\n    }, [fetching])\r\n\r\n    const getMessages = () => {\r\n        axios\r\n            .get(`https://jsonplaceholder.typicode.com/comments?_limit=${limit}&_page=${currentPage}`)\r\n            .then(response => {\r\n                setMessages([...response.data, ...messages])\r\n                setCurrentPage(prev => prev + 1)\r\n                setTotalCount(response.headers[\"x-total-count\"])\r\n            })\r\n            .finally(() => {\r\n                setEndOfPage(false)\r\n                setFetching(false)\r\n                currentPage == 1 && window.scrollTo(window.scrollX, document.body.scrollHeight)\r\n            })\r\n    }\r\n\r\n    useEffect(() => {\r\n        window.addEventListener(\"scroll\", scrollHandler)\r\n        return function () {\r\n            window.removeEventListener(\"scroll\", scrollHandler)\r\n        }\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n        if (endOfPage && messages.length < totalCount) {\r\n            setFetching(true)\r\n        }\r\n    }, [endOfPage])\r\n\r\n    const scrollHandler = (e) => {\r\n        setNeedScroll(false)\r\n        if (e.target.documentElement.scrollTop < 100) {\r\n            setEndOfPage(true)\r\n        }\r\n        if (e.target.documentElement.scrollHeight - (e.target.documentElement.scrollTop + window.innerHeight) < 100) {\r\n            setNeedScroll(true)\r\n        }\r\n    }\r\n\r\n    const sendMessage = (text) => {\r\n        setNeedScroll(true)\r\n        setMessages([...messages, {\r\n            \"userId\": 1,\r\n            \"id\": 2,\r\n            \"title\": \"sunt aut facere repellat provident occaecati excepturi optio reprehenderit\",\r\n            \"email\": \"test@test.test\",\r\n            \"body\": text\r\n        },])\r\n        setNewMessageCount(prev => prev + 1)\r\n    }\r\n\r\n    return (\r\n        <Context.Provider value={{\r\n            messages,\r\n            fetching,\r\n            members, \r\n            chat,\r\n            needScroll,\r\n            limit,\r\n            currentPage,\r\n            sendMessage,\r\n            endOfPage,\r\n            newMessageCount\r\n        }}>\r\n            {children}\r\n        </Context.Provider>\r\n    )\r\n}","import { Header } from \"@vkontakte/vkui\";\r\n\r\nexport const TextSeparator = ({text}) => {\r\n    return ( \r\n        <div className=\"textSeparator\">\r\n            <div className=\"line\"></div>\r\n            <div className=\"text\">\r\n                {text}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n ","import { Avatar, calcInitialsAvatarColor, InitialsAvatar } from \"@vkontakte/vkui\"\r\n\r\nexport const Message = ({\r\n    self = false, \r\n    text,\r\n    caption = \"\",\r\n    hasAvatar = false,\r\n    avatar,\r\n    title,\r\n    id\r\n\r\n}) => {\r\n    return (\r\n        <div className={`messageBox ${self ? \"self\" : \"\"}`}>\r\n            {hasAvatar && avatar && <Avatar size={25}/>}\r\n            {hasAvatar && !avatar && \r\n                <InitialsAvatar size={25} gradientColor={calcInitialsAvatarColor(id)}>\r\n                    {title.substring(0, 2)}\r\n                </InitialsAvatar>\r\n            }\r\n            <div className={`messageTextBox ${self ? \"self\" : \"\"}`}>\r\n                {!self && <div className=\"messageTitle\">{title}</div>}\r\n                <div>{text}</div>\r\n                {caption && <div className=\"messageCaption\">{caption}</div>}\r\n            </div>\r\n        </div>\r\n    )\r\n}","import { Separator, Spinner } from \"@vkontakte/vkui\";\r\nimport React, { useEffect, useLayoutEffect, useRef, useState } from \"react\"\r\nimport { TextSeparator } from \"../components/textSeparator\";\r\nimport { useChatContextProvider } from \"../context/chatContext\";\r\nimport { Message } from \"./message\"\r\n\r\nexport const MessageList = ({ isPublic = true}) => {\r\n    const [scrollHeight, setScrollHeight] = useState(0)\r\n    const { messages, fetching, needScroll, newMessageCount, endOfPage } = useChatContextProvider()\r\n\r\n    const bottomRef = useRef(null)\r\n\r\n    useLayoutEffect(() => {\r\n        if (endOfPage) {\r\n            window.scrollTo(\r\n                window.scrollX,\r\n                document.body.scrollTop + document.documentElement.scrollHeight - scrollHeight\r\n            )\r\n        }\r\n        if(needScroll) {\r\n            bottomRef.current.scrollIntoView({ behavior: \"smooth\"})\r\n        }\r\n    }, [messages]);\r\n\r\n    useLayoutEffect(() => {\r\n        if (endOfPage) {\r\n            setScrollHeight(document.documentElement.scrollHeight)\r\n        }\r\n    }, [endOfPage])\r\n\r\n    return (\r\n        <>\r\n            {fetching && <Spinner style={{marginTop: 10}} />} \r\n           \r\n            <div className=\"messageList\">\r\n                {messages.map(((m, index, arr) => {\r\n                    return ( \r\n                        <React.Fragment key={index}>\r\n                            {arr.length - index == newMessageCount && <TextSeparator text=\"Новые сообщения\" />}\r\n                            <Message\r\n                                text={m.body}\r\n                                caption={m.id}\r\n                                hasAvatar={m.id % 2 == 1 && isPublic}\r\n                                self={m.id % 2 == 0}\r\n                                title={isPublic && m.email}\r\n                                avatar={m.avatar}\r\n                                id={m.id}\r\n                            />\r\n                            {/* {arr[index + 1] ? m.id - arr[index + 1].id == 59 && <TextSeparator text={`${m.id - 59}-${m.id - 60 + 30}`} /> : <></>} */}\r\n                        </React.Fragment>\r\n                    )\r\n                }))}\r\n            </div>\r\n            <div ref={bottomRef}></div>\r\n        </>\r\n    )\r\n}","import { calcInitialsAvatarColor, Card, Cell, FixedLayout, Group, InitialsAvatar, PanelHeader, PanelHeaderBack, PanelHeaderContent, Separator, WriteBar, WriteBarIcon } from \"@vkontakte/vkui\"\r\nimport { Fragment, useEffect, useRef, useState } from \"react\";\r\nimport { useChatContextProvider } from \"../context/chatContext\";\r\nimport { MessageList } from \"../messageComponents/messageList\";\r\n\r\nexport const Chat = ({\r\n    onClose\r\n}) => {\r\n    const [writeBarText, setWriteBarText] = useState(\"\")\r\n    const [bottomPadding, setBottomPadding] = useState(0);\r\n\r\n    const fixedLayoutInnerElRef = useRef();\r\n\r\n    const { members, chat, sendMessage } = useChatContextProvider()\r\n\r\n    const updateBottomPadding = () => {\r\n        const el = fixedLayoutInnerElRef.current;\r\n        if (el) {\r\n            const height = el.offsetHeight;\r\n            if (height !== bottomPadding) {\r\n                setBottomPadding(height);\r\n            }\r\n        }\r\n    };\r\n\r\n    const sendMessageHandler = () => {\r\n        sendMessage(writeBarText)\r\n        setWriteBarText(\"\")\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <PanelHeader\r\n                className=\"shadowPanelHeader\" \r\n                separator={false} \r\n                before={\r\n                    <PanelHeaderBack \r\n                        onClick={() => onClose()}\r\n                    />}\r\n            >\r\n                <PanelHeaderContent\r\n                    before={\r\n                        <InitialsAvatar size={36} gradientColor={calcInitialsAvatarColor(chat.id)}>\r\n                            {chat.title.substring(0, 2)}\r\n                        </InitialsAvatar>\r\n                    }\r\n                    status={`${members.length} участников`}\r\n                >\r\n                    {chat.title.substring(0, 10)}\r\n                </PanelHeaderContent>\r\n            </PanelHeader>\r\n            <MessageList/>\r\n            <FixedLayout\r\n                vertical=\"bottom\"\r\n                style={{paddingBottom: 0}}\r\n            >\r\n                <div ref={fixedLayoutInnerElRef}>\r\n                    <Separator wide />\r\n                    <WriteBar\r\n                        value={writeBarText}\r\n                        onChange={(e) => setWriteBarText(e.target.value)}\r\n                        onHeightChange={() => updateBottomPadding()}\r\n                        placeholder=\"Сообщение\"\r\n                        after={\r\n                            <Fragment>\r\n                                <WriteBarIcon \r\n                                    mode=\"send\" \r\n                                    disabled={writeBarText.length === 0}\r\n                                    onClick={() => sendMessageHandler()}\r\n                                />\r\n                            </Fragment>\r\n                        }\r\n                    />\r\n                </div>\r\n            </FixedLayout>\r\n        </>\r\n    )\r\n}","import React, { useState } from 'react';\r\nimport { View, AdaptivityProvider, AppRoot, ConfigProvider, SplitLayout, SplitCol, PanelHeader, Epic, Tabbar, TabbarItem, Panel } from '@vkontakte/vkui';\r\nimport '@vkontakte/vkui/dist/vkui.css';\r\nimport './styles/index.css'\r\nimport { Icon28MessageOutline, Icon28NewsfeedOutline, Icon28UserCircleOutline } from '@vkontakte/icons';\r\nimport { Events } from './panels/events';\r\nimport { Messages } from './panels/messages';\r\nimport { Profile } from './panels/profile';\r\nimport { Chat } from './panels/chat';\r\nimport { ChatListContextProvider } from './context/chatListContext';\r\nimport { ChatContextProvider } from './context/chatContext';\r\n\r\nconst App = () => {\r\n\tconst [scheme, setScheme] = useState('bright_light')\r\n\tconst [activeStory, setActiveStory] = React.useState(\"messages\")\r\n\tconst [messagesActivePanel, setMessagesActivePanel] = useState(\"messages\")\r\n\tconst [chat, setChat] = useState(null)\r\n\tconst [hasTabbar, setHasTabbar] = useState(true)\r\n\tconst onStoryChange = (e) => setActiveStory(e.currentTarget.dataset.story)\r\n\r\n\tconst openChatHandler = (chat) => {\r\n\t\tsetChat(chat)\r\n\t\tsetMessagesActivePanel(\"chat\")\r\n\t\tsetHasTabbar(false)\r\n\t}\r\n\r\n\tconst closeChatHanler = () => {\r\n\t\tsetMessagesActivePanel(\"messages\")\r\n\t\tsetHasTabbar(true)\r\n\t}\r\n\r\n\treturn (\r\n\t\t<ConfigProvider scheme={scheme}>\r\n\t\t\t<AdaptivityProvider>\r\n\t\t\t\t<AppRoot>\r\n\t\t\t\t\t<SplitLayout\r\n\t\t\t\t\t\theader={<PanelHeader separator={false} />}\r\n\t\t\t\t\t\tstyle={{ justifyContent: \"center\" }}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<SplitCol\r\n\t\t\t\t\t\t\tanimate={true}\r\n\t\t\t\t\t\t\tspaced={false}\r\n\t\t\t\t\t\t\twidth={\"100%\"}\r\n\t\t\t\t\t\t\tmaxWidth={\"100%\"}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<Epic\r\n\t\t\t\t\t\t\t\tactiveStory={activeStory}\r\n\t\t\t\t\t\t\t\ttabbar={hasTabbar &&\r\n\t\t\t\t\t\t\t\t\t<Tabbar>\r\n\t\t\t\t\t\t\t\t\t\t<TabbarItem\r\n\t\t\t\t\t\t\t\t\t\t\tonClick={onStoryChange}\r\n\t\t\t\t\t\t\t\t\t\t\tselected={activeStory === \"events\"}\r\n\t\t\t\t\t\t\t\t\t\t\tdata-story=\"events\"\r\n\t\t\t\t\t\t\t\t\t\t\ttext=\"События\"\r\n\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t<Icon28NewsfeedOutline />\r\n\t\t\t\t\t\t\t\t\t\t</TabbarItem>\r\n\t\t\t\t\t\t\t\t\t\t<TabbarItem\r\n\t\t\t\t\t\t\t\t\t\t\tonClick={onStoryChange}\r\n\t\t\t\t\t\t\t\t\t\t\tselected={activeStory === \"messages\"}\r\n\t\t\t\t\t\t\t\t\t\t\tdata-story=\"messages\"\r\n\t\t\t\t\t\t\t\t\t\t\ttext=\"Сообщения\"\r\n\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t<Icon28MessageOutline />\r\n\t\t\t\t\t\t\t\t\t\t</TabbarItem>\r\n\t\t\t\t\t\t\t\t\t\t<TabbarItem\r\n\t\t\t\t\t\t\t\t\t\t\tonClick={onStoryChange}\r\n\t\t\t\t\t\t\t\t\t\t\tselected={activeStory === \"profile\"}\r\n\t\t\t\t\t\t\t\t\t\t\tdata-story=\"profile\"\r\n\t\t\t\t\t\t\t\t\t\t\ttext=\"Профиль\"\r\n\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t<Icon28UserCircleOutline />\r\n\t\t\t\t\t\t\t\t\t\t</TabbarItem>\r\n\t\t\t\t\t\t\t\t\t</Tabbar>\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<View id=\"events\" activePanel=\"events\">\r\n\t\t\t\t\t\t\t\t\t<Panel id=\"events\">\r\n\t\t\t\t\t\t\t\t\t\t<Events />\r\n\t\t\t\t\t\t\t\t\t</Panel>\r\n\t\t\t\t\t\t\t\t</View>\r\n\t\t\t\t\t\t\t\t<View id=\"messages\" activePanel={messagesActivePanel}>\r\n\t\t\t\t\t\t\t\t\t<Panel id=\"messages\">\r\n\t\t\t\t\t\t\t\t\t\t<ChatListContextProvider>\r\n\t\t\t\t\t\t\t\t\t\t\t<Messages\r\n\t\t\t\t\t\t\t\t\t\t\t\tonChatOpen={openChatHandler}\r\n\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t</ChatListContextProvider>\r\n\t\t\t\t\t\t\t\t\t</Panel>\r\n\t\t\t\t\t\t\t\t\t<Panel id=\"chat\" className=\"chatPanel\">\r\n\t\t\t\t\t\t\t\t\t\t<ChatContextProvider chat={chat}>\r\n\t\t\t\t\t\t\t\t\t\t\t<Chat onClose={closeChatHanler} />\r\n\t\t\t\t\t\t\t\t\t\t</ChatContextProvider>\r\n\t\t\t\t\t\t\t\t\t</Panel>\r\n\t\t\t\t\t\t\t\t</View>\r\n\t\t\t\t\t\t\t\t<View id=\"profile\" activePanel=\"profile\">\r\n\t\t\t\t\t\t\t\t\t<Panel id=\"profile\">\r\n\t\t\t\t\t\t\t\t\t\t<Profile/>\r\n\t\t\t\t\t\t\t\t\t</Panel>\r\n\t\t\t\t\t\t\t\t</View>\r\n\t\t\t\t\t\t\t</Epic>\r\n\t\t\t\t\t\t</SplitCol>\r\n\t\t\t\t\t</SplitLayout>\r\n\t\t\t\t</AppRoot>\r\n\t\t\t</AdaptivityProvider>\r\n\t\t</ConfigProvider>\r\n\t);\r\n}\r\n\r\nexport default App;\r\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport bridge from \"@vkontakte/vk-bridge\";\nimport App from \"./App\";\n\n// Init VK  Mini App\nbridge.send(\"VKWebAppInit\");\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n\n// if (process.env.NODE_ENV === \"development\") {\n//   import(\"./eruda\").then(({ default: eruda }) => {}); //runtime download\n// }\n"],"sourceRoot":""}