(this["webpackJsonpmini-app"]=this["webpackJsonpmini-app"]||[]).push([[0],{145:function(e,t,c){},171:function(e,t,c){"use strict";c.r(t);var n=c(0),s=c.n(n),a=c(19),i=c.n(a),r=c(10),j=c.n(r),o=c(8),l=c(4),b=(c(144),c(145),c(174)),d=c(175),u=c(173),O=c(172),h=c(1),x=function(){return Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)(l.l,{children:"\u0421\u043e\u0431\u044b\u0442\u0438\u044f"}),Object(h.jsx)(l.h,{style:{height:"1000px"},children:Object(h.jsx)(l.o,{icon:Object(h.jsx)(O.a,{width:56,height:56})})})]})},f=c(13),m=c(24),g=Object(n.createContext)(),v=function(e){var t=e.children,c=Object(n.useState)([]),s=Object(o.a)(c,2),a=s[0],i=s[1],r=Object(n.useState)(1),j=Object(o.a)(r,2),l=j[0],b=j[1],d=Object(n.useState)(0),u=Object(o.a)(d,2),O=u[0],x=u[1],v=Object(n.useState)(15),p=Object(o.a)(v,1)[0],w=Object(n.useState)(!0),S=Object(o.a)(w,2),y=S[0],C=S[1],E=Object(n.useState)(!1),k=Object(o.a)(E,2),P=k[0],H=k[1];Object(n.useEffect)((function(){y&&m.get("https://jsonplaceholder.typicode.com/posts?_limit=".concat(p,"&_page=").concat(l)).then((function(e){i([].concat(Object(f.a)(a),Object(f.a)(e.data.filter((function(e){return a.findIndex((function(t){return t.id==e.id}))<0}))))),b((function(e){return e+1})),x(e.headers["x-total-count"])})).finally((function(){H(!1),C(!1)}))}),[y]),Object(n.useEffect)((function(){return window.addEventListener("scroll",N),function(){window.removeEventListener("scroll",N)}}),[]),Object(n.useEffect)((function(){P&&a.length<O&&C(!0)}),[P]);var N=function(e){e.target.documentElement.scrollHeight-(e.target.documentElement.scrollTop+window.innerHeight)<100&&H(!0)};return Object(h.jsx)(g.Provider,{value:{chats:a,fetching:y},children:t})},p=function(e){var t=e.onChatOpen,c=Object(n.useContext)(g),s=c.chats,a=c.fetching;return Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)(l.l,{className:"shadowPanelHeader",separator:!1,children:"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f"}),Object(h.jsx)(l.h,{children:Object(h.jsxs)(l.j,{children:[s.map((function(e){return Object(h.jsx)(l.q,{before:Object(h.jsx)(l.i,{gradientColor:Object(l.z)(e.id),children:e.title.substring(0,2)}),onClick:function(){return t(e)},subtitle:Object(h.jsxs)(h.Fragment,{children:[(c="\u0410\u043b\u0435\u043a\u0441\u0435\u0439: \u0441\u0442\u0438\u043a\u0435\u0440 cnbrth cnbrth cnbrth cnbrt",n=25,c.length>n?c.substring(0,n)+"...":c)," \xb7 2h"]}),indicator:Object(h.jsx)(l.e,{mode:"primary",children:"10"}),children:e.title.substring(0,10)},e.id);var c,n})),a&&Object(h.jsx)(l.r,{})]})})]})},w=function(){return Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)(l.l,{children:"\u041f\u0440\u043e\u0444\u0438\u043b\u044c"}),Object(h.jsx)(l.h,{style:{height:"1000px"},children:Object(h.jsx)(l.o,{icon:Object(h.jsx)(u.a,{width:56,height:56})})})]})},S=c(42),y=c(25),C=c.n(y),E=c(24),k=c.n(E),P=Object(n.createContext)(),H=function(){return Object(n.useContext)(P)},N=function(e){var t=e.children,c=e.chat,s=Object(n.useState)([]),a=Object(o.a)(s,2),i=a[0],r=a[1],j=Object(n.useState)([]),l=Object(o.a)(j,2),b=l[0],d=l[1],u=Object(n.useState)(!0),O=Object(o.a)(u,2),x=O[0],m=O[1],g=Object(n.useState)(1),v=Object(o.a)(g,2),p=v[0],w=v[1],y=Object(n.useState)(0),E=Object(o.a)(y,2),H=E[0],N=E[1],T=Object(n.useState)(30),F=Object(o.a)(T,1)[0],L=Object(n.useState)(!1),z=Object(o.a)(L,2),I=z[0],_=z[1],B=Object(n.useState)(!0),M=Object(o.a)(B,2),A=M[0],J=M[1],R=Object(n.useState)(2),V=Object(o.a)(R,2),W=V[0],X=V[1];Object(n.useEffect)(Object(S.a)(C.a.mark((function e(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:d([1]),setTimeout((function(){q()}),500);case 2:case"end":return e.stop()}}),e)}))),[]),Object(n.useEffect)((function(){x&&b.length>0&&q()}),[x]);var q=function(){k.a.get("https://jsonplaceholder.typicode.com/comments?_limit=".concat(F,"&_page=").concat(p)).then((function(e){r([].concat(Object(f.a)(e.data),Object(f.a)(i))),w((function(e){return e+1})),N(e.headers["x-total-count"])})).finally((function(){_(!1),m(!1),1==p&&window.scrollTo(window.scrollX,document.body.scrollHeight)}))};Object(n.useEffect)((function(){return window.addEventListener("scroll",K),function(){window.removeEventListener("scroll",K)}}),[]),Object(n.useEffect)((function(){I&&i.length<H&&m(!0)}),[I]);var K=function(e){J(!1),e.target.documentElement.scrollTop<100&&_(!0),e.target.documentElement.scrollHeight-(e.target.documentElement.scrollTop+window.innerHeight)<100&&J(!0)};return Object(h.jsx)(P.Provider,{value:{messages:i,fetching:x,members:b,chat:c,needScroll:A,limit:F,currentPage:p,sendMessage:function(e){J(!0),r([].concat(Object(f.a)(i),[{userId:1,id:2,title:"sunt aut facere repellat provident occaecati excepturi optio reprehenderit",email:"test@test.test",body:e}])),X((function(e){return e+1}))},endOfPage:I,newMessageCount:W},children:t})},T=function(e){var t=e.text;return Object(h.jsxs)("div",{className:"textSeparator",children:[Object(h.jsx)("div",{className:"line"}),Object(h.jsx)("div",{className:"text",children:t})]})},F=function(e){var t=e.self,c=void 0!==t&&t,n=e.text,s=e.caption,a=void 0===s?"":s,i=e.hasAvatar,r=void 0!==i&&i,j=e.avatar,o=e.title,b=e.id;return Object(h.jsxs)("div",{className:"messageBox ".concat(c?"self":""),children:[r&&j&&Object(h.jsx)(l.c,{size:25}),r&&!j&&Object(h.jsx)(l.i,{size:25,gradientColor:Object(l.z)(b),children:o.substring(0,2)}),Object(h.jsxs)("div",{className:"messageTextBox ".concat(c?"self":""),children:[!c&&Object(h.jsx)("div",{className:"messageTitle",children:o}),Object(h.jsx)("div",{children:n}),a&&Object(h.jsx)("div",{className:"messageCaption",children:a})]})]})},L=function(e){var t=e.isPublic,c=void 0===t||t,a=Object(n.useState)(0),i=Object(o.a)(a,2),r=i[0],j=i[1],b=H(),d=b.messages,u=b.fetching,O=b.needScroll,x=b.newMessageCount,f=b.endOfPage,m=Object(n.useRef)(null);return Object(n.useLayoutEffect)((function(){f&&window.scrollTo(window.scrollX,document.body.scrollTop+document.documentElement.scrollHeight-r),O&&m.current.scrollIntoView({behavior:"smooth"})}),[d]),Object(n.useLayoutEffect)((function(){f&&j(document.documentElement.scrollHeight)}),[f]),Object(h.jsxs)(h.Fragment,{children:[u&&Object(h.jsx)(l.r,{style:{marginTop:10}}),Object(h.jsx)("div",{className:"messageList",children:d.map((function(e,t,n){return Object(h.jsxs)(s.a.Fragment,{children:[n.length-t==x&&Object(h.jsx)(T,{text:"\u041d\u043e\u0432\u044b\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f"}),Object(h.jsx)(F,{text:e.body,caption:e.id,hasAvatar:e.id%2==1&&c,self:e.id%2==0,title:c&&e.email,avatar:e.avatar,id:e.id})]},t)}))}),Object(h.jsx)("div",{ref:m})]})},z=function(e){var t=e.onClose,c=Object(n.useState)(""),s=Object(o.a)(c,2),a=s[0],i=s[1],r=Object(n.useState)(0),j=Object(o.a)(r,2),b=j[0],d=j[1],u=Object(n.useRef)(),O=H(),x=O.members,f=O.chat,m=O.sendMessage;return Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)(l.l,{className:"shadowPanelHeader",separator:!1,before:Object(h.jsx)(l.m,{onClick:function(){return t()}}),children:Object(h.jsx)(l.n,{before:Object(h.jsx)(l.i,{size:36,gradientColor:Object(l.z)(f.id),children:f.title.substring(0,2)}),status:"".concat(x.length," \u0443\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u043e\u0432"),children:f.title.substring(0,10)})}),Object(h.jsx)(L,{}),Object(h.jsx)(l.g,{vertical:"bottom",style:{paddingBottom:0},children:Object(h.jsxs)("div",{ref:u,children:[Object(h.jsx)(l.p,{wide:!0}),Object(h.jsx)(l.x,{value:a,onChange:function(e){return i(e.target.value)},onHeightChange:function(){return function(){var e=u.current;if(e){var t=e.offsetHeight;t!==b&&d(t)}}()},placeholder:"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",after:Object(h.jsx)(n.Fragment,{children:Object(h.jsx)(l.y,{mode:"send",disabled:0===a.length,onClick:function(){return m(a),void i("")}})})})]})})]})},I=function(){var e=Object(n.useState)("bright_light"),t=Object(o.a)(e,2),c=t[0],a=(t[1],s.a.useState("messages")),i=Object(o.a)(a,2),r=i[0],j=i[1],O=Object(n.useState)("messages"),f=Object(o.a)(O,2),m=f[0],g=f[1],S=Object(n.useState)(null),y=Object(o.a)(S,2),C=y[0],E=y[1],k=Object(n.useState)(!0),P=Object(o.a)(k,2),H=P[0],T=P[1],F=function(e){return j(e.currentTarget.dataset.story)};return Object(h.jsx)(l.d,{scheme:c,children:Object(h.jsx)(l.a,{children:Object(h.jsx)(l.b,{children:Object(h.jsx)(l.t,{header:Object(h.jsx)(l.l,{separator:!1}),style:{justifyContent:"center"},children:Object(h.jsx)(l.s,{animate:!0,spaced:!1,width:"100%",maxWidth:"100%",children:Object(h.jsxs)(l.f,{activeStory:r,tabbar:H&&Object(h.jsxs)(l.u,{children:[Object(h.jsx)(l.v,{onClick:F,selected:"events"===r,"data-story":"events",text:"\u0421\u043e\u0431\u044b\u0442\u0438\u044f",children:Object(h.jsx)(b.a,{})}),Object(h.jsx)(l.v,{onClick:F,selected:"messages"===r,"data-story":"messages",text:"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f",children:Object(h.jsx)(d.a,{})}),Object(h.jsx)(l.v,{onClick:F,selected:"profile"===r,"data-story":"profile",text:"\u041f\u0440\u043e\u0444\u0438\u043b\u044c",children:Object(h.jsx)(u.a,{})})]}),children:[Object(h.jsx)(l.w,{id:"events",activePanel:"events",children:Object(h.jsx)(l.k,{id:"events",children:Object(h.jsx)(x,{})})}),Object(h.jsxs)(l.w,{id:"messages",activePanel:m,children:[Object(h.jsx)(l.k,{id:"messages",children:Object(h.jsx)(v,{children:Object(h.jsx)(p,{onChatOpen:function(e){E(e),g("chat"),T(!1)}})})}),Object(h.jsx)(l.k,{id:"chat",className:"chatPanel",children:Object(h.jsx)(N,{chat:C,children:Object(h.jsx)(z,{onClose:function(){g("messages"),T(!0)}})})})]}),Object(h.jsx)(l.w,{id:"profile",activePanel:"profile",children:Object(h.jsx)(l.k,{id:"profile",children:Object(h.jsx)(w,{})})})]})})})})})})};j.a.send("VKWebAppInit"),i.a.render(Object(h.jsx)(I,{}),document.getElementById("root"))}},[[171,1,2]]]);
//# sourceMappingURL=main.cbf9aa24.chunk.js.map